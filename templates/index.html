<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard BI - Plano Patrimonial Ana | CIMO Multi Family Office</title>
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
   <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Debug Console -->
    <div id="debugConsole" style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.9); color: white; padding: 12px; border-radius: 8px; font-size: 11px; max-width: 350px; display: none; z-index: 9999; max-height: 300px; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <strong style="color: #3b82f6;">üêõ Debug Console</strong>
            <button onclick="toggleDebug()" style="background: #374151; color: white; border: none; padding: 2px 6px; border-radius: 3px; font-size: 10px; cursor: pointer;">‚úï</button>
        </div>
        <div id="debugLog"></div>
        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #374151;">
            <button onclick="window.CimoDebug.testChartJS()" style="background: #059669; color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 10px; margin-right: 4px; cursor: pointer;">Test Chart.js</button>
            <button onclick="window.CimoDebug.forceCharts()" style="background: #ea580c; color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 10px; cursor: pointer;">Force Charts</button>
            <br style="margin: 4px 0;">
            <button onclick="window.CimoDebug.testReport('executivo')" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 10px; margin-right: 4px; margin-top: 4px; cursor: pointer;">Test Executivo</button>
            <button onclick="window.CimoDebug.testReport('simulacao')" style="background: #7c3aed; color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 10px; margin-top: 4px; cursor: pointer;">Test Simula√ß√£o</button>
        </div>
    </div>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="#" class="logo">
                <img src="logo.png" 
                    alt="Logo CIMO" 
                    class="logo-img"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="logo-fallback" style="display: none; font-weight: bold; color: #1e3a8a; font-size: 24px;">
                    CIMO
                </div>
            </a>
        </div>

        <div class="nav-menu">
            <div class="nav-section">
                <div class="nav-section-title">Principal</div>
                <a href="#" class="nav-item active" onclick="showPage('dashboard')">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-item-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="showPage('allocation')">
                    <i class="fas fa-chart-pie"></i>
                    <span class="nav-item-text">Asset Allocation</span>
                </a>
                <a href="#" class="nav-item" onclick="showPage('projections')">
                    <i class="fas fa-chart-area"></i>
                    <span class="nav-item-text">Proje√ß√µes</span>
                </a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">An√°lises</div>
                <a href="#" class="nav-item" onclick="showPage('simulations')">
                    <i class="fas fa-calculator"></i>
                    <span class="nav-item-text">Simula√ß√µes</span>
                </a>
                <a href="#" class="nav-item" onclick="showPage('scenarios')">
                    <i class="fas fa-balance-scale"></i>
                    <span class="nav-item-text">Cen√°rios</span>
                </a>
                <a href="#" class="nav-item" onclick="showPage('sensitivity')">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-item-text">Sensibilidade</span>
                </a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Relat√≥rios</div>
                <a href="#" class="nav-item" onclick="showPage('reports')">
                    <i class="fas fa-file-alt"></i>
                    <span class="nav-item-text">Relat√≥rios</span>
                </a>
                <a href="#" class="nav-item" onclick="generateReportPDF('executivo')">
                    <i class="fas fa-download"></i>
                    <span class="nav-item-text">Exportar PDF</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Dashboard Page -->
        <div class="page-content active" id="dashboardPage">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="toggle-sidebar" id="toggleSidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">
                        <h1>Plano Patrimonial Ana</h1>
                        <p>An√°lise estrat√©gica de investimentos e aloca√ß√£o de recursos</p>
                    </div>
                </div>
                <div class="header-right">
                    <button class="refresh-btn" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span>Atualizar</span>
                    </button>
                   
                </div>
            </header>

            <!-- Controls -->
            
<section class="controls">
    <div class="controls-grid">
        <!-- Input existente: Taxa de Retorno -->
        <div class="control-group">
            <label for="taxaRetorno">
                Taxa de Retorno Real (%)
                <span class="tooltip" title="Taxa j√° descontada da infla√ß√£o (~3.5% a.a.)">*</span>
            </label>
            <input type="range" id="taxaRetorno" class="range-input" min="2" max="8" step="0.1" value="4.0">
            <div class="range-value" id="taxaDisplay">4.0%</div>
            
        </div>
        
        <!-- Input existente: Expectativa de Vida -->
        <div class="control-group">
            <label for="expectativaVida">Expectativa de Vida</label>
            <select id="expectativaVida">
                <option value="85">85 anos</option>
                <option value="90" selected>90 anos</option>
                <option value="95">95 anos</option>
            </select>
        </div>
        
        <!-- Input existente: Despesas Mensais -->
        <div class="control-group">
            <label for="despesasMensais">Despesas Mensais (R$)</label>
            <input type="number" id="despesasMensais" value="150000" step="5000" 
                   min="50000" max="1000000">
        </div>
        
        <!-- NOVO INPUT: Perfil de Investimento -->
        <div class="control-group">
            <label for="perfilInvestimento">Perfil de Investimento
            <span class="tooltip" title="Define aloca√ß√£o de ativos e retorno esperado">*</span> </label>
            <select id="perfilInvestimento">
                <option value="conservador">Conservador (3.5% a.a.)</option>
                <option value="moderado" selected>Moderado (4.5% a.a.)</option>
                <option value="balanceado">Balanceado (5.2% a.a.)</option>
            </select>
          
        </div>
        
            <!-- NOVO INPUT: In√≠cio da Renda dos Filhos -->
        <div class="control-group">
            <label for="inicioRendaFilhos">
                In√≠cio da Renda dos Filhos
                <span class="tooltip" title="Escolha quando os filhos devem come√ßar a receber: ao falecimento de Ana, imediatamente ou a partir de certa idade">*</span>
            </label>
            <select id="inicioRendaFilhos">
                <option value="falecimento" selected>Ap√≥s falecimento de Ana</option>
                <option value="imediato">Imediatamente</option>
                <option value="65">Aos 65 anos de Ana</option>
                <option value="70">Aos 70 anos de Ana</option>
                <option value="75">Aos 75 anos de Ana</option>
            </select>
            
        </div>
        
        <!-- NOVO INPUT: Custo Estimado da Fazenda -->
        <div class="control-group">
            <label for="custoFazenda">Custo Estimado da Fazenda (R$)
            <span class="tooltip" title="Usado para calcular verba dispon√≠vel para arte">*</span>
            
            </label>
            <input type="number" id="custoFazenda" value="2000000" step="100000" 
                   min="500000" max="10000000">
         
        </div>
        
        <!-- Input existente: Status Sistema -->
        <div class="control-group">
            <label>Status Sistema</label>
            <div class="status-indicator" id="systemStatus">
                <i class="fas fa-circle"></i>
                <span>Verificando...</span>
            </div>
        </div>
    </div>
    
    <!-- NOVA SE√á√ÉO: Legenda de Unidades -->
    <div class="currency-legend" style="margin-top: 16px; padding: 12px; background: var(--gray-50); border-radius: 8px; font-size: 0.8rem; color: var(--gray-600);">
        <strong>üí° Legenda:</strong> M = milh√µes, k = mil | 
        <strong>Taxa:</strong> Sempre REAL (j√° descontada da infla√ß√£o) |
        <strong>Doa√ß√µes:</strong> Exatamente 15 anos
    </div>
</section>

            <!-- Dashboard Content -->
            <div class="dashboard">
                <!-- Alert Container -->
                <div id="alertContainer"></div>

                <!-- Chart.js Loading Status -->
                <div id="chartjsStatus" style="display: none; padding: 16px; background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; margin-bottom: 20px; color: #92400e;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Carregando biblioteca de gr√°ficos... <span id="chartjsRetries">0</span>/5 tentativas</span>
                    </div>
                </div>

                <!-- Metrics -->
                <section class="metrics-grid fade-in">
    <!-- Patrim√¥nio Total (OK) -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-content">
                <h3 id="valorPatrimonio">R$ 65,0M</h3>
                <p>Patrim√¥nio Total</p>
                <div class="metric-trend neutral">
                    <i class="fas fa-wallet"></i>
                    <span>Base de c√°lculo</span>
                </div>
            </div>
            <div class="metric-icon blue">
                <i class="fas fa-coins"></i>
            </div>
        </div>
    </div>

    <!-- Fazenda (OK) -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-content">
                <h3 id="valorFazenda">R$ 5,2M</h3>
                <p>Dispon√≠vel para Fazenda</p>
                <div class="metric-trend positive" id="trendFazenda">
                    <i class="fas fa-arrow-up"></i>
                    <span id="percentualFazenda">8.0%</span>
                </div>
            </div>
            <div class="metric-icon green">
                <i class="fas fa-seedling"></i>
            </div>
        </div>
    </div>

    <!-- Compromissos (OK) -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-content">
                <h3 id="valorCompromissos">R$ 59,8M</h3>
                <p>Total Compromissos</p>
                <div class="metric-trend neutral">
                    <i class="fas fa-handshake"></i>
                    <span>Valor presente</span>
                </div>
            </div>
            <div class="metric-icon orange">
                <i class="fas fa-calendar-check"></i>
            </div>
        </div>
    </div>

    <!-- Status do Plano (OK) -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-content">
                <h3 id="valorStatus">Vi√°vel</h3>
                <p>Status do Plano</p>
                <div class="metric-trend positive">
                    <i class="fas fa-check-circle"></i>
                    <span>Objetivos ating√≠veis</span>
                </div>
            </div>
            <div class="metric-icon purple">
                <i class="fas fa-chart-line"></i>
            </div>
        </div>
    </div>

    <!-- ‚úÖ ARTE/GALERIA - CORRIGIDO -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-content">
                <h3 id="valorArte">R$ 3,2M</h3>
                <p>Dispon√≠vel para Arte/Galeria</p>
                <div class="metric-trend positive" id="trendArte">
                    <i class="fas fa-palette"></i>
                    <span id="percentualArte">4.9%</span>
                </div>
            </div>
            <div class="metric-icon purple">
                <i class="fas fa-brush"></i>
            </div>
        </div>
    </div>

    <!-- ‚úÖ PERFIL DE INVESTIMENTO - CORRIGIDO -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-content">
                <h3 id="perfilAtual">Moderado</h3>
                <p>Perfil de Investimento</p>
                <div class="metric-trend neutral">
                    <i class="fas fa-chart-line"></i>
                    <span id="retornoEsperado">4.5% a.a.</span>
                </div>
            </div>
            <div class="metric-icon blue">
                <i class="fas fa-balance-scale"></i>
            </div>
        </div>
    </div>
</section>
                <section class="quick-actions" style="padding: 24px 32px; background: var(--white); border-bottom: 1px solid var(--border);">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                        
                        <!-- Indicador de Status do Plano -->
                        <div class="plan-status" id="planStatusIndicator">
                            <div class="status-badge viavel" id="statusBadge">
                                <i class="fas fa-check-circle"></i>
                                <span id="statusText">Vi√°vel</span>
                            </div>
                            <small id="statusDescription" style="color: var(--gray-600); margin-left: 8px;">
                                Plano sustent√°vel com boa margem
                            </small>
                        </div>
                        
                        <!-- A√ß√µes de Relat√≥rio -->
                        <div class="report-actions" style="display: flex; gap: 12px;">
                            <button class="widget-action" onclick="generateReportPDF('executivo')" 
                                    title="Gerar Relat√≥rio Executivo">
                                <i class="fas fa-file-pdf"></i>
                                <span>Executivo</span>
                            </button>
                            <button class="widget-action" onclick="generateReportPDF('detalhado')" 
                                    title="Gerar An√°lise Detalhada">
                                <i class="fas fa-file-alt"></i>
                                <span>Detalhado</span>
                            </button>
                            <button class="widget-action" onclick="generateReportPDF('simulacao')" 
                                    title="Gerar Relat√≥rio com Simula√ß√µes">
                                <i class="fas fa-chart-line"></i>
                                <span>Simula√ß√£o</span>
                            </button>
                        </div>
                    </div>
                </section>
                <!-- Charts -->
                <section class="charts-grid fade-in">
                    <div class="chart-widget">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-pie"></i>
                                Breakdown dos Compromissos
                            </h3>
                            <div class="widget-actions">
                                <button class="widget-action" onclick="exportChart('compromissos')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container" id="compromissosContainer">
                            <canvas id="compromissosChart" style="display: none;"></canvas>
                            <div class="chart-placeholder loading">
                                <i class="fas fa-spinner"></i>
                                <div>Carregando gr√°fico...</div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-widget">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-donut"></i>
                                Asset Allocation
                            </h3>
                            <div class="widget-actions">
                                <button class="widget-action" onclick="exportChart('allocation')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container" id="allocationContainer">
                            <canvas id="allocationChart" style="display: none;"></canvas>
                            <div class="chart-placeholder loading">
                                <i class="fas fa-spinner"></i>
                                <div>Carregando gr√°fico...</div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-widget full-width">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-line"></i>
                                An√°lise de Sensibilidade - Impacto da Taxa de Retorno
                            </h3>
                            <div class="widget-actions">
                                <button class="widget-action" onclick="exportChart('sensibilidade')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container large" id="sensibilidadeContainer">
                            <canvas id="sensibilidadeChart" style="display: none;"></canvas>
                            <div class="chart-placeholder loading">
                                <i class="fas fa-spinner"></i>
                                <div>Carregando gr√°fico...</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Table -->
                <section class="data-table fade-in">
                    <div class="table-header">
                        <h3 class="table-title">
                            <i class="fas fa-table"></i>
                            An√°lise Comparativa de Cen√°rios
                        </h3>
                        <div class="widget-actions">
                            <button class="widget-action" onclick="exportTable()">
                                <i class="fas fa-file-excel"></i>
                                Exportar CSV
                            </button>
                        </div>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Taxa Real (%)</th>
                                    <th>Valor Fazenda</th>
                                    <th>% Patrim√¥nio</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="cenarioTableBody">
                                <!-- Table content will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>

        <!-- Simulations Page -->
        <div class="page-content" id="simulationsPage">
            <header class="header">
                <div class="header-left">
                    <button class="toggle-sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">
                        <h1>Simula√ß√µes Monte Carlo</h1>
                        <p>An√°lise probabil√≠stica de cen√°rios</p>
                    </div>
                </div>
            </header>
            
            <div class="dashboard">
                <!-- Simulation Parameters -->
                <div class="simulation-parameters">
                    <h3 style="margin-bottom: 20px; color: var(--gray-900);">
                        <i class="fas fa-sliders-h" style="color: var(--primary); margin-right: 8px;"></i>
                        Par√¢metros da Simula√ß√£o
                    </h3>
                    <div class="control-row">
                        <div class="control-group">
                            <label for="simTaxaMin">Taxa M√≠nima (%)</label>
                            <input type="range" id="simTaxaMin" min="1" max="5" step="0.1" value="2.5" onchange="updateSimulationParams()">
                            <div class="range-value" id="simTaxaMinDisplay">2.5%</div>
                        </div>
                        <div class="control-group">
                            <label for="simTaxaMax">Taxa M√°xima (%)</label>
                            <input type="range" id="simTaxaMax" min="5" max="10" step="0.1" value="7.0" onchange="updateSimulationParams()">
                            <div class="range-value" id="simTaxaMaxDisplay">7.0%</div>
                        </div>
                        <div class="control-group">
                            <label for="simVolatilidade">Volatilidade (%)</label>
                            <input type="range" id="simVolatilidade" min="5" max="25" step="1" value="15" onchange="updateSimulationParams()">
                            <div class="range-value" id="simVolatilidadeDisplay">15%</div>
                        </div>
                        <div class="control-group">
                            <label for="simSimulacoes">N¬∫ Simula√ß√µes</label>
                            <select id="simSimulacoes" onchange="updateSimulationParams()">
                                <option value="100">100</option>
                                <option value="500" selected>500</option>
                                <option value="1000">1000</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="simulation-results">
                        <h4 style="margin-bottom: 16px; color: var(--gray-700);">Resultados da Simula√ß√£o</h4>
                        <div class="results-grid">
                            <div class="result-item">
                                <div class="result-value" id="simResultP10">R$ -2,1M</div>
                                <div class="result-label">Cen√°rio Pessimista (P10)</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value" id="simResultP50">R$ 5,8M</div>
                                <div class="result-label">Cen√°rio M√©dio (P50)</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value" id="simResultP90">R$ 15,2M</div>
                                <div class="result-label">Cen√°rio Otimista (P90)</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value" id="simSuccessRate">72%</div>
                                <div class="result-label">Taxa de Sucesso</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-widget">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-line"></i>
                                Monte Carlo - Trajet√≥rias Patrimoniais
                            </h3>
                            <div class="widget-actions">
                                <button class="widget-action" onclick="exportChart('monteCarlo')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container" id="monteCarloContainer">
                            <canvas id="monteCarloChart" style="display: none;"></canvas>
                            <div class="chart-placeholder loading">
                                <i class="fas fa-spinner"></i>
                                <div>Carregando simula√ß√£o...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-widget">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-bar"></i>
                                Distribui√ß√£o de Resultados
                            </h3>
                            <div class="widget-actions">
                                <button class="widget-action" onclick="exportChart('distribuicao')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container" id="distribuicaoContainer">
                            <canvas id="distribuicaoChart" style="display: none;"></canvas>
                            <div class="chart-placeholder loading">
                                <i class="fas fa-spinner"></i>
                                <div>Carregando distribui√ß√£o...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">
                            <i class="fas fa-calculator"></i>
                            Estat√≠sticas Detalhadas da Simula√ß√£o
                        </h3>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Percentil</th>
                                    <th>Valor Fazenda</th>
                                    <th>Probabilidade</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>P5 (Pior caso)</strong></td>
                                    <td id="simP5">-R$ 5,2M</td>
                                    <td>5%</td>
                                    <td><span class="status-badge danger">Cr√≠tico</span></td>
                                </tr>
                                <tr>
                                    <td><strong>P10 (Pessimista)</strong></td>
                                    <td id="simP10">-R$ 2,1M</td>
                                    <td>10%</td>
                                    <td><span class="status-badge danger">Invi√°vel</span></td>
                                </tr>
                                <tr>
                                    <td><strong>P25 (Conservador)</strong></td>
                                    <td id="simP25">R$ 1,8M</td>
                                    <td>25%</td>
                                    <td><span class="status-badge warning">Aten√ß√£o</span></td>
                                </tr>
                                <tr>
                                    <td><strong>P50 (Mediana)</strong></td>
                                    <td id="simP50">R$ 5,8M</td>
                                    <td>50%</td>
                                    <td><span class="status-badge success">Vi√°vel</span></td>
                                </tr>
                                <tr>
                                    <td><strong>P75 (Otimista)</strong></td>
                                    <td id="simP75">R$ 11,2M</td>
                                    <td>75%</td>
                                    <td><span class="status-badge success">Excelente</span></td>
                                </tr>
                                <tr>
                                    <td><strong>P90 (Muito Otimista)</strong></td>
                                    <td id="simP90">R$ 15,2M</td>
                                    <td>90%</td>
                                    <td><span class="status-badge success">Excepcional</span></td>
                                </tr>
                                <tr>
                                    <td><strong>P95 (Melhor caso)</strong></td>
                                    <td id="simP95">R$ 21,8M</td>
                                    <td>95%</td>
                                    <td><span class="status-badge success">Extraordin√°rio</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Page -->
        <div class="page-content" id="reportsPage">
            <header class="header">
                <div class="header-left">
                    <button class="toggle-sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">
                        <h1>Relat√≥rios</h1>
                        <p>Documenta√ß√£o executiva e an√°lises detalhadas</p>
                    </div>
                </div>
            </header>
            
            <div class="dashboard">
                <!-- Report Generation Actions -->
                <div class="report-actions">
                    <div class="report-card" onclick="generateReportPDF('executivo')">
                        <i class="fas fa-file-alt"></i>
                        <h3>Relat√≥rio Executivo</h3>
                        <p>Resumo estrat√©gico com principais m√©tricas e recomenda√ß√µes</p>
                    </div>
                    
                    <div class="report-card" onclick="generateReportPDF('tecnico')">
                        <i class="fas fa-file-invoice"></i>
                        <h3>An√°lise Detalhada</h3>
                        <p>Relat√≥rio completo com todos os c√°lculos e proje√ß√µes</p>
                    </div>
                    
                    <div class="report-card" onclick="generateReportPDF('simulacao')">
                        <i class="fas fa-chart-line"></i>
                        <h3>Simula√ß√£o Monte Carlo</h3>
                        <p>Relat√≥rio detalhado incluindo an√°lise probabil√≠stica e cen√°rios</p>
                    </div>
                </div>
                
                <!-- Report Status -->
                <div id="reportStatus" style="display: none;" class="alert warning">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Gerando relat√≥rio... Isso pode levar alguns segundos.</span>
                </div>
                
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">
                            <i class="fas fa-history"></i>
                            Hist√≥rico de Relat√≥rios Gerados
                        </h3>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Tipo de Relat√≥rio</th>
                                    <th>Par√¢metros</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="reportHistoryBody">
                                <tr>
                                    <td colspan="5" style="text-align: center; color: var(--gray-500); padding: 40px;">
                                        Nenhum relat√≥rio gerado ainda. Clique em um dos cart√µes acima para gerar seu primeiro relat√≥rio.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Include other pages (keeping existing ones) -->
        <!-- Asset Allocation Page -->
        <div class="page-content" id="allocationPage">
            <header class="header">
                <div class="header-left">
                    <button class="toggle-sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">
                        <h1>Asset Allocation</h1>
                        <p>Distribui√ß√£o estrat√©gica de ativos do portf√≥lio</p>
                    </div>
                </div>
            </header>
            
            <div class="dashboard">
                <div class="charts-grid">
                    <div class="chart-widget">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-pie"></i>
                                Aloca√ß√£o Atual
                            </h3>
                        </div>
                        <div class="chart-container" id="currentAllocationContainer">
                            <canvas id="currentAllocationChart" style="display: none;"></canvas>
                            <div class="chart-placeholder loading">
                                <i class="fas fa-spinner"></i>
                                <div>Carregando gr√°fico...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-widget">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-bar"></i>
                                Compara√ß√£o com Benchmark
                            </h3>
                        </div>
                        <div class="chart-container" id="benchmarkContainer">
                            <canvas id="benchmarkChart" style="display: none;"></canvas>
                            <div class="chart-placeholder loading">
                                <i class="fas fa-spinner"></i>
                                <div>Carregando gr√°fico...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">
                            <i class="fas fa-list"></i>
                            Detalhamento da Aloca√ß√£o
                        </h3>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Classe de Ativo</th>
                                    <th>Aloca√ß√£o Atual</th>
                                    <th>Valor (R$)</th>
                                    <th>Retorno Esperado</th>
                                    <th>Risco (Volatilidade)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Renda Fixa Nacional</td>
                                    <td>40%</td>
                                    <td>R$ 26,0M</td>
                                    <td>3.5% a.a.</td>
                                    <td>Baixo (2-4%)</td>
                                </tr>
                                <tr>
                                    <td>Renda Fixa Internacional</td>
                                    <td>15%</td>
                                    <td>R$ 9,8M</td>
                                    <td>2.5% a.a.</td>
                                    <td>Baixo-M√©dio (3-6%)</td>
                                </tr>
                                <tr>
                                    <td>Multimercado</td>
                                    <td>15%</td>
                                    <td>R$ 9,8M</td>
                                    <td>4.5% a.a.</td>
                                    <td>M√©dio (5-8%)</td>
                                </tr>
                                <tr>
                                    <td>A√ß√µes Brasil</td>
                                    <td>10%</td>
                                    <td>R$ 6,5M</td>
                                    <td>6.0% a.a.</td>
                                    <td>Alto (15-25%)</td>
                                </tr>
                                <tr>
                                    <td>A√ß√µes Internacionais</td>
                                    <td>10%</td>
                                    <td>R$ 6,5M</td>
                                    <td>5.5% a.a.</td>
                                    <td>Alto (12-20%)</td>
                                </tr>
                                <tr>
                                    <td>Im√≥veis/REITs</td>
                                    <td>5%</td>
                                    <td>R$ 3,3M</td>
                                    <td>4.0% a.a.</td>
                                    <td>M√©dio (8-12%)</td>
                                </tr>
                                <tr>
                                    <td>Reserva de Liquidez</td>
                                    <td>5%</td>
                                    <td>R$ 3,3M</td>
                                    <td>1.5% a.a.</td>
                                    <td>Muito Baixo (0-1%)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Projections Page -->
        <div class="page-content" id="projectionsPage">
            <header class="header">
                <div class="header-left">
                    <button class="toggle-sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">
                        <h1>Proje√ß√µes Financeiras</h1>
                        <p>An√°lise temporal do patrim√¥nio e fluxos de caixa</p>
                    </div>
                </div>
            </header>
            
            <div class="dashboard">
                <div class="projection-grid">
                    <div class="chart-widget">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-line"></i>
                                Evolu√ß√£o Patrimonial
                            </h3>
                        </div>
                        <div class="chart-container large" id="patrimonialEvolutionContainer">
                            <canvas id="patrimonialEvolutionChart" style="display: none;"></canvas>
                            <div class="chart-placeholder loading">
                                <i class="fas fa-spinner"></i>
                                <div>Carregando gr√°fico...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="projection-summary">
                        <h3>Resumo das Proje√ß√µes</h3>
                        <div class="projection-metric">
                            <span>Patrim√¥nio em 10 anos:</span>
                            <strong>R$ 89,2M</strong>
                        </div>
                        <div class="projection-metric">
                            <span>Patrim√¥nio em 20 anos:</span>
                            <strong>R$ 97,5M</strong>
                        </div>
                        <div class="projection-metric">
                            <span>Patrim√¥nio aos 90 anos:</span>
                            <strong>R$ 0,8M</strong>
                        </div>
                        <div class="projection-metric">
                            <span>Sustentabilidade:</span>
                            <strong>At√© 89 anos</strong>
                        </div>
                    </div>
                </div>
                
                <div class="scenario-cards">
                    <div class="scenario-card active" onclick="updateProjection('conservador')">
                        <h4>Conservador</h4>
                        <div class="value">3.0%</div>
                        <div class="change">Taxa real a.a.</div>
                    </div>
                    <div class="scenario-card" onclick="updateProjection('moderado')">
                        <h4>Moderado</h4>
                        <div class="value">4.5%</div>
                        <div class="change">Taxa real a.a.</div>
                    </div>
                    <div class="scenario-card" onclick="updateProjection('agressivo')">
                        <h4>Agressivo</h4>
                        <div class="value">6.0%</div>
                        <div class="change">Taxa real a.a.</div>
                    </div>
                </div>
                
                <div class="chart-widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-chart-area"></i>
                            Fluxo de Caixa Projetado
                        </h3>
                    </div>
                    <div class="chart-container" id="cashFlowContainer">
                        <canvas id="cashFlowChart" style="display: none;"></canvas>
                        <div class="chart-placeholder loading">
                            <i class="fas fa-spinner"></i>
                            <div>Carregando gr√°fico...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scenarios Page -->
        <div class="page-content" id="scenariosPage">
            <header class="header">
                <div class="header-left">
                    <button class="toggle-sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">
                        <h1>An√°lise de Cen√°rios</h1>
                        <p>Compara√ß√£o detalhada de diferentes estrat√©gias</p>
                    </div>
                </div>
            </header>
            
            <div class="dashboard">
                <div class="analysis-tabs">
                    <button class="analysis-tab active" onclick="showAnalysis('comparison')">Compara√ß√£o</button>
                    <button class="analysis-tab" onclick="showAnalysis('stress')">Stress Test</button>
                    <button class="analysis-tab" onclick="showAnalysis('optimization')">Otimiza√ß√£o</button>
                </div>
                
                <div class="analysis-content active" id="comparisonContent">
                    <div class="charts-grid">
                        <div class="chart-widget">
                            <div class="widget-header">
                                <h3 class="widget-title">
                                    <i class="fas fa-chart-bar"></i>
                                    Cen√°rios de Retorno
                                </h3>
                            </div>
                            <div class="chart-container" id="scenarioComparisonContainer">
                                <canvas id="scenarioComparisonChart" style="display: none;"></canvas>
                                <div class="chart-placeholder loading">
                                    <i class="fas fa-spinner"></i>
                                    <div>Carregando gr√°fico...</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-widget">
                            <div class="widget-header">
                                <h3 class="widget-title">
                                    <i class="fas fa-chart-line"></i>
                                    Evolu√ß√£o por Cen√°rio
                                </h3>
                            </div>
                            <div class="chart-container" id="scenarioEvolutionContainer">
                                <canvas id="scenarioEvolutionChart" style="display: none;"></canvas>
                                <div class="chart-placeholder loading">
                                    <i class="fas fa-spinner"></i>
                                    <div>Carregando gr√°fico...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-content" id="stressContent">
                    <div class="alert warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        An√°lise de stress test considerando cen√°rios adversos
                    </div>
                    
                    <div class="charts-grid">
                        <div class="chart-widget full-width">
                            <div class="widget-header">
                                <h3 class="widget-title">
                                    <i class="fas fa-chart-area"></i>
                                    Stress Test - Cen√°rios Adversos
                                </h3>
                            </div>
                            <div class="chart-container" id="stressTestContainer">
                                <canvas id="stressTestChart" style="display: none;"></canvas>
                                <div class="chart-placeholder loading">
                                    <i class="fas fa-spinner"></i>
                                    <div>Carregando gr√°fico...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-content" id="optimizationContent">
                    <div class="alert success">
                        <i class="fas fa-lightbulb"></i>
                        Recomenda√ß√µes de otimiza√ß√£o baseadas na an√°lise
                    </div>
                    
                    <div class="data-table">
                        <div class="table-header">
                            <h3 class="table-title">
                                <i class="fas fa-cogs"></i>
                                Estrat√©gias de Otimiza√ß√£o
                            </h3>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Estrat√©gia</th>
                                        <th>Impacto no Valor Fazenda</th>
                                        <th>Risco</th>
                                        <th>Implementa√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Reduzir doa√ß√µes de R$50k para R$35k</td>
                                        <td>+R$ 2,8M</td>
                                        <td>Baixo</td>
                                        <td>Imediato</td>
                                    </tr>
                                    <tr>
                                        <td>Postergar renda dos filhos em 2 anos</td>
                                        <td>+R$ 3,1M</td>
                                        <td>Baixo</td>
                                        <td>Planejamento</td>
                                    </tr>
                                    <tr>
                                        <td>Aumentar aloca√ß√£o em a√ß√µes para 25%</td>
                                        <td>+R$ 4,2M</td>
                                        <td>M√©dio</td>
                                        <td>6 meses</td>
                                    </tr>
                                    <tr>
                                        <td>Reduzir despesas mensais para R$130k</td>
                                        <td>+R$ 4,8M</td>
                                        <td>Alto</td>
                                        <td>Lifestyle</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sensitivity Page -->
        <div class="page-content" id="sensitivityPage">
            <header class="header">
                <div class="header-left">
                    <button class="toggle-sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">
                        <h1>An√°lise de Sensibilidade</h1>
                        <p>Impacto das vari√°veis-chave nos resultados</p>
                    </div>
                </div>
            </header>
            
            <div class="dashboard">
                <div class="charts-grid">
                    <div class="chart-widget">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-line"></i>
                                Sensibilidade √† Taxa de Retorno
                            </h3>
                        </div>
                        <div class="chart-container" id="returnSensitivityContainer">
                            <canvas id="returnSensitivityChart" style="display: none;"></canvas>
                            <div class="chart-placeholder loading">
                                <i class="fas fa-spinner"></i>
                                <div>Carregando gr√°fico...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-widget">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-bar"></i>
                                Sensibilidade √†s Despesas
                            </h3>
                        </div>
                        <div class="chart-container" id="expenseSensitivityContainer">
                            <canvas id="expenseSensitivityChart" style="display: none;"></canvas>
                            <div class="chart-placeholder loading">
                                <i class="fas fa-spinner"></i>
                                <div>Carregando gr√°fico...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-widget full-width">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-area"></i>
                                An√°lise Bidimensional
                            </h3>
                        </div>
                        <div class="chart-container" id="bidimensionalContainer">
                            <canvas id="bidimensionalChart" style="display: none;"></canvas>
                            <div class="chart-placeholder loading">
                                <i class="fas fa-spinner"></i>
                                <div>Carregando gr√°fico...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">
                            <i class="fas fa-table"></i>
                            Matriz de Sensibilidade
                        </h3>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Taxa / Despesas</th>
                                    <th>R$ 120k</th>
                                    <th>R$ 150k</th>
                                    <th>R$ 180k</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>3.0%</strong></td>
                                    <td>R$ 1,2M</td>
                                    <td>-R$ 5,0M</td>
                                    <td>-R$ 11,5M</td>
                                </tr>
                                <tr>
                                    <td><strong>4.0%</strong></td>
                                    <td>R$ 11,8M</td>
                                    <td>R$ 5,2M</td>
                                    <td>-R$ 1,8M</td>
                                </tr>
                                <tr>
                                    <td><strong>5.0%</strong></td>
                                    <td>R$ 20,1M</td>
                                    <td>R$ 13,4M</td>
                                    <td>R$ 6,2M</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Chart.js with advanced retry mechanism -->
    
<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>